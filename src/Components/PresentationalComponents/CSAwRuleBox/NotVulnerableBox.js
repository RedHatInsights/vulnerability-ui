import React from 'react';
import PropTypes from 'prop-types';
import {
    Text,
    TextContent,
    TextVariants,
    SplitItem,
    Split,
    Card,
    CardBody,
    ExpandableSection,
    Button
} from '@patternfly/react-core';
import { InsightsLink } from '@redhat-cloud-services/frontend-components/InsightsLink';
import { useIntl } from 'react-intl';
import messages from '../../../Messages';
import './CSAwRuleBox.scss';
import NotVulnerableLabel from '../Snippets/NotVulnerableLabel';
import { ONLY_NON_VULNERABLE_SYSTEMS } from '../../../Helpers/constants';

const NotVulnerableBox = ({ synopsis, notVulnerableSystemCount, setHeaderFilters, headerFilters }) => {
    const intl = useIntl();
    const handleExposedSystemFilter = () => {
        setHeaderFilters(headerFilters?.rule !== ONLY_NON_VULNERABLE_SYSTEMS
            ? { rule: ONLY_NON_VULNERABLE_SYSTEMS }
            : { rule: undefined }
        );
    };

    return (
        notVulnerableSystemCount > 0 &&
        <Card className="card-box" ouiaId="not-vulnerable-box">
            <ExpandableSection toggleText={
                <Split>
                    <SplitItem className="pf-v5-u-mr-xl">
                        <TextContent>
                            <Text component={TextVariants.h4}>
                                <NotVulnerableLabel className="pf-v5-u-mr-sm" />
                                {intl.formatMessage(messages.notVulnerableBoxTitle)}
                            </Text>
                        </TextContent>
                    </SplitItem>
                    <SplitItem id="filter-affected-systems-split" className="pf-v5-u-mr-xl">
                        <TextContent>
                            <Button
                                id="filter-affected-systems"
                                onClick={event => {
                                    handleExposedSystemFilter();
                                    event.stopPropagation();
                                }}
                                isActive={headerFilters?.rule === ONLY_NON_VULNERABLE_SYSTEMS}
                                size="sm"
                                isInline
                                variant="secondary"
                            >
                                <InsightsLink
                                    to={`/cves/${synopsis}`}
                                >
                                    {
                                        intl.formatMessage(
                                            messages.filterByAffectedSystems,
                                            {
                                                count: notVulnerableSystemCount
                                            }
                                        )
                                    }
                                </InsightsLink>
                            </Button>
                        </TextContent>
                    </SplitItem>
                </Split>
            }>
                <CardBody className="rule-card-body">
                    {intl.formatMessage(messages.notVulnerableDescription, { multiple: true })}
                </CardBody>
            </ExpandableSection>
        </Card>
    );
};

NotVulnerableBox.propTypes = {
    synopsis: PropTypes.string,
    notVulnerableSystemCount: PropTypes.number,
    setHeaderFilters: PropTypes.func,
    headerFilters: PropTypes.object
};

export default NotVulnerableBox;
