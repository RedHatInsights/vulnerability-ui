import React, { Fragment } from 'react';
import { Text, TextContent, TextVariants, Tooltip } from '@patternfly/react-core';
import PropType from 'prop-types';
import { FormattedMessage } from 'react-intl';
import InsightsReportCard from '@redhat-cloud-services/frontend-components-inventory-insights/esm/InsightsReportCard';
import { CSAwIcon } from '../../PresentationalComponents/CustomIcons/CustomIcons';
import Label from '../../PresentationalComponents/Snippets/Label';
import { RH_KB_URL } from '../../../Helpers/constants';
import messages from '../../../Messages';

export const InsightsSystemRule = ({ rule, cve }) => {
    return (
        <Fragment>
            { !rule ? <InsightsNoSystemRule cve={cve}/> :
                <Fragment>
                    <TextContent className="icon-with-label">
                        <Text component={TextVariants.h3} style={{ paddingLeft: 'var(--pf-global--spacer--lg)' }}>
                            <Label>
                                <Tooltip content={<FormattedMessage {...messages.rulesIconTooltip} />}>
                                    <CSAwIcon />
                                </Tooltip>
                            </Label>
                            <span className="rule-name">{rule.rule.description || rule.rule.rule_id}</span>
                        </Text>
                    </TextContent>

                    <InsightsReportCard
                        report={rule}
                        kbaLoading={false}
                        kbaDetail={{ view_uri: `${RH_KB_URL}/${rule.rule.node_id}` }}
                    />
                </Fragment>
            }
        </Fragment>
    );
};

InsightsSystemRule.propTypes = {
    rule: PropType.shape({
        rule: PropType.object,
        details: PropType.object,
        resulotion: PropType.object
    }),
    cve: PropType.string
};

export const InsightsNoSystemRule = ({ cve }) => {
    return (
        <TextContent className="icon-with-label">
            <Text component={TextVariants.p}>
                <FormattedMessage {...messages.exposedSystemNoRules} values={{ cve }} />
            </Text>
            <Text component={TextVariants.p} className="pf-u-mb-sm">
                <FormattedMessage {...messages.exposedSystemNoRulesInfo}/> <CSAwIcon/>
            </Text>
            <Text
                component={TextVariants.a}
                target="_blank"
                rel="noopener noreferrer"
                href="https://access.redhat.com/articles/2968471"
            >
                <FormattedMessage {...messages.exposedSystemNoRulesInfoLink} />
            </Text>
        </TextContent>
    );
};

InsightsNoSystemRule.propTypes = {
    cve: PropType.string
};
