import { getAffectedSystemsByCVE } from '../../../Helpers/APIHelper';

const getTotalItems = apiResult => (apiResult?.meta?.total_items || 0);

export const fetchHybridSystemsCounts = async (
    cveName,
    isEdgeParityEnabled,
    setHybridSystemsCounts
) => {
    try {
        const conventionalCount = await getAffectedSystemsByCVE({ id: cveName, host_type: 'rpmdnf', limit: 1 })
            .then(getTotalItems);

        const edgeCount = isEdgeParityEnabled
            ? await getAffectedSystemsByCVE({ id: cveName, host_type: 'edge', limit: 1 }).then(getTotalItems)
            : 0;

        setHybridSystemsCounts({
            conventionalCount,
            edgeCount,
            areCountsLoading: false
        });
    }
    catch {
        setHybridSystemsCounts({
            conventionalCount: 0,
            edgeCount: 0,
            areCountsLoading: false
        });
    }
};
