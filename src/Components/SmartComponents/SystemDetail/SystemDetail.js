import propTypes from 'prop-types';
import React from 'react';
import { connect } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { SystemExludedFromAnalysis, SystemNotFound } from '../../../Helpers/constants';
import { dispatchAction } from '../../../Helpers/Dispatcher';
import { setHeader } from '../../../Store/Actions/Actions';
import { paths } from '../../../Utilities/Routes';
import Vulnerabilities from '../SystemCves/SystemCves';

class SystemDetail extends React.Component {
    static propTypes = {
        setHeader: propTypes.func,
        entity: propTypes.object,
        isOptOut: propTypes.bool,
        optOutSystemHandler: propTypes.func
    };

    constructor(props) {
        super(props);
    }

    render() {
        const { entity, isOptOut, optOutSystemHandler } = this.props;
        this.props.setHeader({
            breadcrumbs: [
                { title: paths.vulnerabilities.title, to: paths.vulnerabilities.to },
                { title: paths.systems.title, to: paths.systems.to },
                { title: (entity && entity.display_name) || 'Invalid System', isActive: true }
            ]
        });

        if (!entity) {
            return (
                <SystemNotFound />
            );
        }

        if (!isOptOut) {
            return (
                <React.Fragment>
                    <Vulnerabilities entity={entity.id} />
                </React.Fragment>
            );
        } else {
            return (
                <React.Fragment>
                    <SystemExludedFromAnalysis buttonAction={() => optOutSystemHandler(false)} />
                </React.Fragment>
            );
        }
    }
}

const mapDispatchToProps = () => {
    return {
        setHeader: header => dispatchAction(setHeader(header))
    };
};

function mapStateToProps({ entityDetails: { entity, opt_out: isOptOut } }) {
    return {
        entity,
        isOptOut
    };
}

export default withRouter(
    connect(
        mapStateToProps,
        mapDispatchToProps
    )(SystemDetail)
);
