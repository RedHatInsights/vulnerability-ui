import { conditionalFilterType } from '@redhat-cloud-services/frontend-components/ConditionalFilter';
import { intl } from '../../../../Utilities/IntlProvider';
import messages from '../../../../Messages';
import { AFFECTING_FILTER_OPTIONS } from '../../../../Helpers/constants';

const affectingFilter = (apply, currentFilter = {}) => {
    let { affecting: currentValue } = currentFilter;

    const filterByAffecting = (values) => {
        const defaultValues = [false, false];
        values.forEach(item => { defaultValues[item] = true; });
        const filter = defaultValues.join(',');
        apply({ affecting: filter === 'false,false' ? '' : filter, page: 1 });
    };

    return {
        label: intl.formatMessage(messages.affectsSystems),
        type: conditionalFilterType.checkbox,
        urlParam: 'affecting',
        filterValues: {
            onChange: (event, value) => {
                filterByAffecting(value);
            },
            items: AFFECTING_FILTER_OPTIONS.map(item => ({ label: item.label, value: item.value })),
            value: currentValue?.split(',').flatMap((value, index) => value?.toLowerCase() === 'true' ? index.toString() : [])
        }
    };
};

export default affectingFilter;
