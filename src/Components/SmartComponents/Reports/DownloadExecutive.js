
import React, { useState } from 'react';
import { useIntl } from 'react-intl';
import { DownloadButton } from '@redhat-cloud-services/frontend-components-pdf-generator';
import { getExecutiveReport } from '../../../Helpers/APIHelper';
import messages from '../../../Messages';
import buildExecReport from './BuildExecReport';

const DownloadExecutive = () => {
    const intl = useIntl();
    const [loading, setLoading] = useState(false);

    const dataFetch = async () => {
        setLoading(true);

        const data = await getExecutiveReport();
        const report = buildExecReport({ data, intl });

        setLoading(false);
        return [...report];
    };

    const [date] = new Date().toISOString().split('T');

    return (
        <DownloadButton
            label={loading ? intl.formatMessage(messages.loading) : intl.formatMessage(messages.executiveReportCardButton)}
            asyncFunction={dataFetch}
            buttonProps={{ variant: 'link', isInline: true }}
            type={intl.formatMessage(messages.vulnerabilitiesHeader)}
            fileName={`vulnerability_executive-report--${date}.pdf`}
            allPagesHaveTitle={false}
        />
    );
};

export default DownloadExecutive;
