import { conditionalFilterType } from '@redhat-cloud-services/frontend-components';
import { intl } from '../../../../Utilities/IntlProvider';

import debounce from 'lodash/debounce';
import React from 'react';

const SearchFilter = (label, placeholder, search, apply) => {
    const [searchValue, setSearchValue] = React.useState();
    const [handleSearch] = React.useState(() =>
        debounce(filter =>  {if (filter !== undefined) { apply({ filter, page: 1 }); }}, 400)
    );

    React.useEffect(() => setSearchValue(search), [search]);

    return {
        type: conditionalFilterType.text,
        label: intl.formatMessage(label),
        filterValues: {
            'aria-label': 'search-field',
            id: `search-${label.id}`,
            onChange: (event, value) => {
                setSearchValue(value);
                handleSearch(value);
            },
            placeholder: intl.formatMessage(placeholder),
            value: searchValue
        }
    };
};

export default SearchFilter;
