import * as ActionTypes from '../ActionTypes';
import { CVEDetailsPageStore, initialState } from './CVEDetailsPageStore';
import Immutable from 'seamless-immutable';

let action;
describe('CVE reducer:', () => {
    beforeEach(() => {
        action = {
            type: undefined,
            payload: {},
        };
    });

    it('Should return initial state', () => {
        expect(CVEDetailsPageStore(undefined, {})).toEqual(initialState);
    });

    it('Should set initial state on empty action', () => {
        expect(CVEDetailsPageStore(undefined, action)).toEqual(initialState);
    });

    it('Should start loading CVE_List for a system', () => {
        action.type = ActionTypes.FETCH_AFFECTED_SYSTEMS_BY_CVE + '_PENDING';
        expect(CVEDetailsPageStore(undefined, action).affectedSystemsByCVE.isLoading).toEqual(true);
    });

    it('Should load CVE_List for a system', () => {
        let testObject = { testObject: 'value' };
        action.type = ActionTypes.FETCH_AFFECTED_SYSTEMS_BY_CVE + '_FULFILLED';
        action.payload = testObject;
        expect(CVEDetailsPageStore(undefined, action).affectedSystemsByCVE).toEqual({ isLoading: false, payload: testObject, openedRows: [] });
    });

    it('Should start loading CVE Details ', () => {
        action.type = ActionTypes.FETCH_CVE_DETAILS + '_PENDING';
        expect(CVEDetailsPageStore(undefined, action).cveDetails.isLoading).toEqual(true);
    });

    it('Should load CVE Details', () => {
        let testObject = { testObject: 'value' };
        action.type = ActionTypes.FETCH_CVE_DETAILS + '_FULFILLED';
        action.payload = testObject;
        expect(CVEDetailsPageStore(undefined, action).cveDetails).toEqual({ isLoading: false, error: false, payload: testObject });
    });

    it('Should handle CVE Details error', () => {
        action.type = ActionTypes.HANDLE_CVE_DETAILS_ERROR;
        action.payload = { error: true}
        expect(CVEDetailsPageStore(undefined, action).cveDetails).toEqual({ isLoading: false, error: true, payload: {} });
    });

    it('Should load change parameters of CVEDetailsPageStore', () => {
        let testObject = { testObject: 'value' };
        action.type = ActionTypes.CHANGE_EXPOSED_SYSTEMS_PARAMETERS;
        action.payload = testObject;
        expect(CVEDetailsPageStore(undefined, action).parameters).toEqual(
            expect.objectContaining(testObject)
        );
    });

    it('Should clear CVEStore and return initial state', () => {
        action.type = ActionTypes.CLEAR_CVE_STORE;
        expect(CVEDetailsPageStore(undefined, action)).toEqual(initialState);
    });
});
