import React, { Fragment } from 'react';
import PropTypes from 'prop-types';

import { Section, Column, Chart, Table, Panel, PanelItem } from '@redhat-cloud-services/frontend-components-pdf-generator';
import { Text } from '@react-pdf/renderer';
import { truncate } from 'lodash';

import styles from '../Common/styles';
import messages from '../../../../Messages';

const SecondPage = ({ data, intl }) => {
    const cveDesc = (rule) => <Text style={styles.mb8}> {truncate(rule, { length: 300 })}</Text>;

    const {
        recentCvesData,
        CVSSChart,
        CVSSData,
        CVSSHeader,
        topCves
    } = data;

    return (
        <Fragment key="first-section">
            <Text style={styles.header}>{intl.formatMessage(messages.cvesHeader)}</Text>
            <Section title={intl.formatMessage(messages.executiveReportCvesByCVSS)}>
                <Column>
                    <Chart
                        chartType="pie"
                        subTitle="Cves"
                        title="100"
                        data={CVSSChart}
                    />
                </Column>
                <Column>
                    <Table
                        withHeader
                        rows={[CVSSHeader, ...CVSSData]}
                    />
                </Column>
            </Section>
            <Section title={intl.formatMessage(messages.executiveReportRecentlyPublishedCves)}>
                <Panel style={{ flex: 1 }}>
                    {
                        recentCvesData.map(([label, value])=> (
                            <Fragment key={label}>
                                <PanelItem style={{ flex: 1 }} title={label}>
                                    {value}
                                </PanelItem>
                            </Fragment>
                        ))
                    }
                </Panel>
            </Section>
            <Section title={intl.formatMessage(messages.executiveReportTop3)} withColumn={false}>
                {
                    topCves.map(cve => (
                        <Panel key={cve.synopsis} title={cve.synopsis} description={cveDesc(cve.description)}>
                            <PanelItem title={intl.formatMessage(messages.executiveReportPanelTitle)}>
                                {Number.parseFloat(cve.cvss3_score).toFixed(1)}
                            </PanelItem>
                            <PanelItem title={intl.formatMessage(messages.systemsExposed)}>
                                {cve.systems_affected.toString()}
                            </PanelItem>
                        </Panel>
                    ))

                }
            </Section>
        </Fragment>
    );
};

SecondPage.propTypes = {
    data: PropTypes.exact({
        recentCvesData: PropTypes.array,
        CVSSChart: PropTypes.array,
        CVSSData: PropTypes.array,
        CVSSHeader: PropTypes.array,
        topCves: PropTypes.array
    }),
    intl: PropTypes.any
};

export default SecondPage;
