
import { useCallback } from 'react';
import { useIntl } from 'react-intl';
import { buildCveReportConfig } from '../../../Helpers/ReportsHelper';
import { useDownloadReport } from '../../../Helpers/ReportsHelper';
import {
    PDF_REPORT_TEMPLATES,
    getReportFilename
} from '../../../Helpers/constants';

const useDownloadCveReport = (params, filters, reportData) => {
    const intl = useIntl();

    const downloadReport = useDownloadReport(
        PDF_REPORT_TEMPLATES.vulnerabilities,
        getReportFilename('reports')
    );

    return useCallback((user) => {
        const processedFilters = {
            ...params,
            page: 1,
            page_size: Math.min(Number.MAX_SAFE_INTEGER, 9007199254740991),
            sort: params.sort || '-cvss_score',
            affecting: 'true',
            advanced_report: 'true'
        };

        const reportConfig = buildCveReportConfig({
            filters,
            intl,
            reportData,
            user
        });

        downloadReport({
            filters: processedFilters,
            reportConfig
        });
    }, [params, filters, reportData]);
};

export default useDownloadCveReport;
