import React, { Fragment } from 'react';
import PropTypes from 'prop-types';
import { FormattedMessage } from 'react-intl';
import { intl } from '../../../Utilities/IntlProvider';
import { Text, TextContent, TextVariants, Stack, StackItem } from '@patternfly/react-core';
import Label from '../Snippets/Label';
import CSAwLabel from '../Snippets/CSAwLabel';
import CSAwRuleSummary from '../CSAwRuleBox/CSAwRuleSummary';
import messages from '../../../Messages';
import { handleCVELink } from '../../../Helpers/VulnerabilityHelper';
import { NoDescriptionAvailable } from '../EmptyStates/EmptyStates';

const CVETableExpandedCell = ({ description, rules, cve, linkToCustomerPortal }) => {
    const hasDescription = description && description !== 'unknown';

    return (
        <TextContent className="expanded-cell">
            {
                hasDescription ? (
                    <Fragment>
                        <Label className="pf-v5-u-mb-sm"><FormattedMessage {...messages.description} /></Label>
                        <Text data-testid="expanded-cell-description" component={TextVariants.p}>{description}</Text>
                    </Fragment>
                ) : <NoDescriptionAvailable/>
            }
            <Stack hasGutter>
                {rules && rules.map((rule, i) => (
                    rule && (
                        <div data-testid="rule-content" key={i} className="rule">
                            <CSAwLabel className="pf-v5-u-mr-sm"/>
                            <Label isInline>
                                <span className="rule-name">{rule.description || rule.rule_id}</span>
                            </Label>
                            <CSAwRuleSummary
                                text={rule.summary}
                                truncate={false}
                                className="pf-v5-u-mt-xs"
                            />
                        </div>
                    )
                ))}
                <StackItem className="rule-link">
                    {handleCVELink(cve, intl.formatMessage(messages.viewMoreAboutThisCve), null, linkToCustomerPortal, true)}
                </StackItem>
            </Stack>
        </TextContent>
    );

};

CVETableExpandedCell.propTypes = {
    description: PropTypes.string,
    rules: PropTypes.array,
    cve: PropTypes.string,
    linkToCustomerPortal: PropTypes.bool
};

export default CVETableExpandedCell;
