import React from 'react';
import toJson from 'enzyme-to-json';
import CVEDetailsPageDescription from './CVEDetailsPageSummary';
import { BrowserRouter as Router } from 'react-router-dom';
import configureStore from 'redux-mock-store';
import { Provider } from 'react-redux';
import { mountWithIntl } from '../../../Helpers/MiscHelper';
import { initialState } from '../../../Store/Reducers/CVEDetailsPageStore';

const customMiddleWare = store => next => action => {
    useSelector.mockImplementation(callback => {
        return callback({ CVEDetailsPageStore: state });
    });
    React.createRef.mockImplementation(() => ({current: { onRefreshData: () => {}   } }));
    next(action);
}

const mockStore = configureStore([customMiddleWare]);
let store = mockStore(initialState);

describe('CVEDetailsPageSummary component', () => {
    it('should render without data', () => {
        const data = {
            data: {},
            meta: {},
            isLoading: false
        };
        const wrapper = mountWithIntl(
            <Provider store={store}>
                <Router>
                    <CVEDetailsPageDescription data={ data } />
                </Router>
            </Provider>
        );
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should render with data', () => {
        const data = {
            data: {
                impact: 'Important',
                cvss3_score: '7.000',
                public_date: 'February 18th, 2019',
                description: 'Lorem ipsum',
                synopsis: 'CVE-2019-6454',
                package_list: [{
                    type: 'li',
                    key: 'systemd-resolved-219-62.el7_6.5.i686',
                    ref: null,
                    props: {
                        children: 'systemd-resolved-219-62.el7_6.5.i686'
                    },
                    _owner: null,
                    _store: {}
                }, {
                    type: 'li',
                    key: 'systemd-resolved-219-62.el7_6.5.x86_64',
                    ref: null,
                    props: {
                        children: 'systemd-resolved-219-62.el7_6.5.x86_64'
                    },
                    _owner: null,
                    _store: {}
                }, {
                    type: 'li',
                    key: 'systemd-devel-219-62.el7_6.5.ppc',
                    ref: null,
                    props: {
                        children: 'systemd-devel-219-62.el7_6.5.ppc'
                    },
                    _owner: null,
                    _store: {}
                }],
                rh_link: {
                    type: 'a',
                    key: null,
                    ref: null,
                    props: {
                        href: 'https://access.redhat.com/security/cve/CVE-2019-6454',
                        children: 'Red Hat CVE Database'
                    },
                    _owner: null,
                    _store: {}
                },
                mitre_link: {
                    type: 'a',
                    key: null,
                    ref: null,
                    props: {
                        href: 'https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-6454',
                        children: 'MITRE Database'
                    },
                    _owner: null,
                    _store: {}
                }
            },
            meta: {},
            isLoading: false
        };

        const wrapper = mountWithIntl(
            <Provider store={store}>
                <Router>
                    <CVEDetailsPageDescription data={ { data }  } />
                </Router>
            </Provider>
        );
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should render with long description', () => {
        const data = {
            data: {
                impact: 'Important',
                cvss3_score: '7.000',
                public_date: 'February 18th, 2019',
                description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi consectetur molestie tristique.'
                    + ' Proin ornare urna ut consequat pellentesque. Sed commodo porta sollicitudin.'
                    + ' Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque habitant morbi'
                    + ' tristique senectus et netus et nullam.',
                synopsis: 'CVE-2019-6454',
                package_list: []
            },
            meta: {},
            isLoading: false
        };
        const wrapper = mountWithIntl(
            <Provider store={store}>
                <Router>
                    <CVEDetailsPageDescription data={ { data }  } />
                </Router>
            </Provider>
        );
        expect(toJson(wrapper)).toMatchSnapshot();
    });

    it('should render with enabled WithLoader', () => {
        const data = {
            data: {},
            meta: {},
            isLoading: true
        };
        const wrapper = mountWithIntl(
            <Provider store={store}>
                <Router>
                    <CVEDetailsPageDescription data={ { data }  } />
                </Router>
            </Provider>
        );
        expect(toJson(wrapper)).toMatchSnapshot();
    });
});
