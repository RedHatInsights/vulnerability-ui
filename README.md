[![Build Status](https://travis-ci.com/RedHatInsights/vulnerability-ui.svg?branch=master)](https://app.travis-ci.com/github/RedHatInsights/vulnerability-ui)
[![GitHub release](https://img.shields.io/github/release/RedHatInsights/vulnerability-ui.svg)](https://github.com/RedHatInsights/vulnerability-ui/releases/latest)
[![codecov](https://codecov.io/gh/RedHatInsights/vulnerability-ui/branch/master/graph/badge.svg)](https://codecov.io/gh/RedHatInsights/vulnerability-ui)

# Vulnerability UI
Red Hat Insights Vulnerability service is used to assess and monitor the status of security vulnerabilities on RHEL systems, understand the level of exposure of infrastructure, and plan a course of action. This is the front-end repository for this service.

## First time setup
1. Make sure you have [Node.js](https://nodejs.org/en/) version >= 16 installed
2. Run [script to patch your `/etc/hosts`](https://github.com/RedHatInsights/insights-proxy/blob/master/scripts/patch-etc-hosts.sh)
3. Make sure you are using [Red Hat proxy](http://hdn.corp.redhat.com/proxy.pac)

## Running locally
1. Install dependencies with `npm install`
2. Run development server with `npm run start:proxy`
3. While you run the command above, you will be prompted to choose an enviroment.

## Testing federated modules with another application

If you want to test Vulnerability with another application deployed locally, you can utilise `LOCAL_APPS` environment variable and deploy the needed application on separate ports. To learn more about the variable, see https://github.com/RedHatInsights/frontend-components/tree/master/packages/config#running-multiple-local-frontend-applications.

### Example

We'll take for example [insights-inventory-frontend](https://github.com/RedHatInsights/insights-inventory-frontend).

Open new terminal, navigate to Inventory repository, and run it on a separate port without proxy:

```
npm run start -- --port=8003
```

In a separate terminal, run Vulnerability with proxy enabled and list Inventory:

```
LOCAL_APPS=inventory:8003~http npm run start:proxy
```

## Testing
[Jest](https://jestjs.io/) and [Cypress](https://www.cypress.io/) are used as the testing frameworks
- ```npm run test``` - run all tests
- ```npm run test:ct``` - run all Cypress tests
- ```npm run test:jest``` - run all Jest tests
- ```npm run test:jest -- testName``` - run Jest tests for all components matching `testName`
- ```npm run test:jest:update``` - run all Jest tests and update snapshots
- ```npm run test:jest:watch``` - run Jest tests in watch mode
- ```npm run lint``` - run linter

## Deploying
Any push to the following branches will trigger a build in [vulnerability-ui-build repository](https://github.com/RedHatInsights/vulnerability-ui-build) which will deploy to corresponding environment. Travis is used to deploy the application.

| Push to branch in this repo  | Updated branch in build repo  | Environment       | Available at
| :--------------------------- | :---------------------------- | :---------------- | :-----------
| master                       | stage-beta                    | stage beta        | https://console.stage.redhat.com/preview
| stage-stable                 | stage-stable                  | stage stable      | https://console.stage.redhat.com
| prod-beta                    | prod-beta                     | production beta   | https://console.redhat.com/preview
| prod-stable                  | prod-stable                   | production stable | https://console.redhat.com

## Internationalization

### Translation keys
Translation keys are saved in [`messages.js`](https://github.com/RedHatInsights/vulnerability-ui/blob/master/src/Messages.js). 

### Generating translation keys
Each time you add a new translation keys you need to run `npm run translations`, which will automatically generate JSON files for every language into [`locales/`](https://github.com/RedHatInsights/vulnerability-ui/tree/master/locales) folder based on the entries in the [`messages.js`](https://github.com/RedHatInsights/vulnerability-ui/blob/master/src/Messages.js). 

### Using translated strings
There are two ways to use translated strings:
1. With `intl.formatMessage(messages.messageId)`
2. With `<FormattedMessage {...messages.messageId}/>`

## Design System
This project uses [Patternfly React](https://github.com/patternfly/patternfly-react).

## Insights Components
This app imports components from [Insights Front-end Components library](https://github.com/RedHatInsights/frontend-components). ESI tags are used to import [Insights Chrome](https://github.com/RedHatInsights/insights-chrome) which takes care of the header, sidebar, and footer.
