import { Text, TextContent, TextVariants } from '@patternfly/react-core';
import propTypes from 'prop-types';
import { FormattedMessage } from 'react-intl';
import messages from '../../../Messages';
import React, { useState, useEffect } from 'react';

const TruncatedText = ({ characterLimit, showMoreLabel, showLessLabel, content: description, component }) => {
    const [isDescriptionTruncated, setDescriptionTruncated] = useState(true);
    const [isDescriptionTooLong, setDescriptionTooLong] = useState(false);
    const [shortDescription, setShortDescription] = useState('');

    useEffect(() => {
        if (String(description).length > characterLimit) {
            setDescriptionTooLong(true);
            setShortDescription(description.slice(0, characterLimit - 1) + 'â€¦');
        }
        else {
            setDescriptionTooLong(false);
            setDescriptionTruncated(false);
        }
    }, []);

    return (
        <TextContent>
            <Text component={component}>{isDescriptionTruncated ? shortDescription : description}</Text>
            {isDescriptionTooLong && (
                <a rel="noopener noreferrer" onClick={() => setDescriptionTruncated(!isDescriptionTruncated)}>
                    {isDescriptionTruncated ? showMoreLabel : showLessLabel}
                </a>
            )}
        </TextContent>
    );
};

TruncatedText.propTypes = {
    component: propTypes.any,
    content: propTypes.string,
    characterLimit: propTypes.number,
    showMoreLabel: propTypes.oneOfType([
        propTypes.string,
        propTypes.object
    ]),
    showLessLabel: propTypes.oneOfType([
        propTypes.string,
        propTypes.object
    ])
};

TruncatedText.defaultProps = {
    component: TextVariants.p,
    showMoreLabel: <FormattedMessage {...messages.readMore}/>,
    showLessLabel: <FormattedMessage {...messages.readLess}/>,
    characterLimit: 250
};

export default TruncatedText;
