import React from 'react';
import { render, screen, waitFor } from '@testing-library/react';
import CVEDetailsPageSummary from './CVEDetailsPageSummary';
import configureStore from 'redux-mock-store';
import { initialState } from '../../../Store/Reducers/CVEDetailsPageStore';
import { CVEPageContext } from '../../SmartComponents/CVEDetailsPage/CVEDetailsPage';
import TestWrapper from '../../../Utilities/TestWrapper';

const customMiddleWare = store => next => action => {
    useSelector.mockImplementation(callback => {
        return callback({ CVEDetailsPageStore: state });
    });
    React.createRef.mockImplementation(() => ({ current: { onRefreshData: () => {}   } }));
    next(action);
}

const mockStore = configureStore([customMiddleWare]);
let store = mockStore(initialState);

describe('CVEDetailsPageSummary component', () => {
    it('should render with data', () => {
        const data = {
            data: {
                impact: 'Important',
                business_risk: 'Low',
                cvss3_score: '7.000',
                public_date: 'February 18th, 2019',
                description: 'Lorem ipsum',
                synopsis: 'CVE-2019-6454'
            },
            meta: {},
            isLoading: false
        };

        render(
            <TestWrapper store={ store }>
                <CVEPageContext.Provider value={{ isLoading: false }}>
                    <CVEDetailsPageSummary data={data} />
                </CVEPageContext.Provider>
            </TestWrapper>
        );

        expect(screen.getByText(data.data.description)).toBeTruthy();
    });

    it('should render with long description', () => {
        const data = {
            data: {
                impact: 'Important',
                business_risk: 'Low',
                cvss3_score: '7.000',
                public_date: 'February 18th, 2019',
                description: 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi consectetur molestie tristique.'
                    + ' Proin ornare urna ut consequat pellentesque. Sed commodo porta sollicitudin.'
                    + ' Interdum et malesuada fames ac ante ipsum primis in faucibus. Pellentesque habitant morbi'
                    + ' tristique senectus et netus et nullam.',
                synopsis: 'CVE-2019-6454',
            },
            meta: {},
            isLoading: false
        };
        render(
            <TestWrapper store={ store }>
                <CVEPageContext.Provider value={{ isLoading: false }}>
                    <CVEDetailsPageSummary data={data} />
                </CVEPageContext.Provider>
            </TestWrapper>
        );

        expect(screen.getByText(data.data.description)).toBeTruthy();
    });
});
