import LandingPage from './LandingPage';
import TestWrapper from '../../../Utilities/TestWrapper';
import { render, screen } from '@testing-library/react';
import configureStore from 'redux-mock-store';
import { cveState } from '../mockData.fixtures';
import { initialState } from '../../../Store/Reducers/CVEsStore';
import { useSelector } from 'react-redux';

jest.mock('../../../Helpers/Hooks', () => ({
    ...jest.requireActual('../../../Helpers/Hooks'),
    useRbac: () => [[true, true, true, true], false],
    useHybridSystemFilterFlag: jest.fn(() => false)
}));

jest.mock('../../../Store/Actions/Actions', () => ({
    ...jest.requireActual('../../../Store/Actions/Actions'),
    fetchCveListByAccount: () => ({
        type: 'FETCH_CVE_LIST',
        payload: new Promise(() => {})
    })
}));

jest.mock("react-redux", () => ({
    ...jest.requireActual("react-redux"),
    useSelector: jest.fn()
}));

jest.mock('@unleash/proxy-client-react', () => ( {
    ...jest.requireActual('@unleash/proxy-client-react'),
    useFlag: () => true, 
    useFlagsStatus: () => ({ flagsReady: true })
}));

const customMiddleWare = store => next => action => {
    useSelector.mockImplementation(callback => {
        return callback({ CVEsStore: cveState });
    });
    next(action);
}

const mockStore = configureStore([customMiddleWare]);
const store = mockStore(initialState);

beforeEach(() => {
    store.clearActions();
    useSelector.mockImplementation(callback => {
        return callback({ CVEsStore: initialState });
    });
});

afterEach(() => {
    useSelector.mockClear();
});

describe('CVEs: ', () => {
    it.skip('Should match the snapshot', () => {
        const { asFragment } = render(
            <TestWrapper store={ store }>
                <LandingPage />
            </TestWrapper>
        );
        expect(asFragment()).toMatchSnapshot();
    });

    it.skip('Should render Header with props showBreadcrumb = false', () => {
        render(
            <TestWrapper store={ store }>
                <LandingPage />
            </TestWrapper>
        );

        expect(screen.getByRole('heading', { name: 'CVEs' })).toBeTruthy();
        expect(screen.queryAllByTestId('PfBreadcrumb')).toHaveLength(0);
    });

    it.skip('Should render VulnerabilitiesCves', () => {
        render(
            <TestWrapper store={ store }>
                <LandingPage />
            </TestWrapper>
        );

        expect(screen.getByRole('grid', { name: 'Vulnerability CVE table' })).toBeTruthy();
    });
});
