import CvssVector, { parseVector } from './CvssVector';
import { V3names, V2names } from './vectorNames';
import { render, screen } from '@testing-library/react';
import TestWrapper from '../../../Utilities/TestWrapper';

describe('CvssVector', () => {
    it('Should render with CVSSv2', () => {
        render(
            <TestWrapper>
                <CvssVector cvss2_metrics="AV:L/AC:H/Au:N/C:N/I:N/A:P" />
            </TestWrapper>
        );

        expect(screen.getByText('CVSS 2.0 base score')).toBeTruthy();
    });

    it('Should render with CVSSv3', () => {
        render(
            <TestWrapper>
                <CvssVector cvss3_metrics="CVSS:3.0/AV:A/AC:L/PR:L/UI:R/S:U/C:L/I:N/A:N" />
            </TestWrapper>
        );

        expect(screen.getByText('CVSS 3.0 base score')).toBeTruthy();
    });

    it('Should render CVSSv3 when given both', () => {
        render(
            <TestWrapper>
                <CvssVector cvss2_metrics="AV:L/AC:H/Au:N/C:N/I:N/A:P" cvss3_metrics="CVSS:3.0/AV:A/AC:L/PR:L/UI:R/S:U/C:L/I:N/A:N"/>
            </TestWrapper>
        );
        expect(screen.getByText('CVSS 3.0 base score')).toBeTruthy();
        expect(screen.queryAllByText('CVSS 2.0 base score')).toHaveLength(0);
    });

    it('Should parse CVSSv2', () => {
        const parsed = parseVector('AV:L/AC:H/Au:N/C:N/I:N/A:P', V2names);
        expect(parsed).toMatchObject({
            'Access vector': 'Local',
            'Access complexity': 'High',
            Authentication: 'None',
            'Confidentiality impact': 'None',
            'Integrity impact': 'None',
            'Availability impact': 'Partial'
        });
    });

    it('Should parse CVSSv3', () => {
        const parsed = parseVector('CVSS:3.0/AV:A/AC:L/PR:L/UI:R/S:U/C:L/I:N/A:N', V3names);
        expect(parsed).toMatchObject({
            cvssVersion: 3,
            'Attack vector': 'Adjacent',
            'Attack complexity': 'Low',
            'Privileges required': 'Low',
            'User interaction': 'Required',
            Scope: 'Unchanged',
            Confidentiality: 'Low',
            Integrity: 'None',
            Availability: 'None'
        });
    });

    it('Should parse invalid vector and not fail', () => {
        const parsed = parseVector('CVSS:3.0/AV:A/AC:L/XX:XX', V3names);
        expect(parsed).toMatchObject({ cvssVersion: 3, 'Attack vector': 'Adjacent', 'Attack complexity': 'Low' });
    });
});
