import { getAffectedSystemsByCVE } from '../../../Helpers/APIHelper';

const getTotalItems = apiResult => (apiResult?.meta?.total_items || 0);

export const fetchHybridSystemsCounts = async (
    cveName,
    isEdgeParityEnabled,
    setHybridSystemsCounts
) => {
    const filters = { id: cveName, limit: 1, advisory_available: true };
    try {
        const conventionalCount = await getAffectedSystemsByCVE({ ...filters,  host_type: 'rpmdnf' })
            .then(getTotalItems);

        const edgeCount = isEdgeParityEnabled
            ? await getAffectedSystemsByCVE({ ...filters, host_type: 'edge' }).then(getTotalItems)
            : 0;

        setHybridSystemsCounts({
            conventionalCount,
            edgeCount,
            areCountsLoading: false
        });
    }
    catch {
        setHybridSystemsCounts({
            conventionalCount: 0,
            edgeCount: 0,
            areCountsLoading: false
        });
    }
};
