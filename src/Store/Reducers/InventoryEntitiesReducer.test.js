import { initialState, inventoryEntitiesReducer } from './InventoryEntitiesReducer';

let action;
let columns;
let getSelected;
let testState;

describe('inventoryEntitiesReducer', () => {
    beforeEach(() => {
        action = {
            type: undefined,
            payload: {}
        };

        columns = [
            { key: 'display_name', title: 'Name', composed: ['facts.os_release', 'fqdn'] },
            { key: 'tags', title: 'Tags' },
        ];

        getSelected = () => { return new Set() };

        testState = {
            ...initialState,
            loaded: true,
            selectedRows: ['testId'],
            rows: [{ id: 'testId', selected: false }]
        };
    });

    it('Should return initial state', () => {
        const wrappingFn = inventoryEntitiesReducer(columns, getSelected);
        const reducer = wrappingFn(undefined, {});
        expect(reducer).toEqual(initialState);
    });

    it('Should set initial state on empty action', () => {
        const wrappingFn = inventoryEntitiesReducer(columns, getSelected);
        const reducer = wrappingFn(undefined, action);
        expect(reducer).toEqual(initialState);
    });

    it('Should set empty array to columns state', () => {
        const wrappingFn = inventoryEntitiesReducer(undefined, getSelected);
        const reducer = wrappingFn(undefined, action);
        expect(reducer.columns).toEqual([]);
    })

    it('Should return initial state when loaded is false/undefined', () => {
        const testObject = { ...initialState, loaded: false, selectedRows: {} }
        const wrappingFn = inventoryEntitiesReducer(columns, getSelected);
        action.type = 'LOAD_ENTITIES_FULFILLED';
        const reducer = wrappingFn(testObject, action);
        expect(reducer).toEqual(testObject);
    });


    it('Should expand row', () => {
        const testObject = [{ id: 'testId', isOpen: true }];
        const wrappingFn = inventoryEntitiesReducer(columns, getSelected);
        action.type = 'EXPAND_ROW';
        action.payload = testObject;
        const reducer = wrappingFn({ ...initialState, rows: testObject }, action);
        expect(reducer).toEqual({
            ...initialState,
            rows: testObject
        });
    });

    it('Should clear Inverntory', () => {
        const testObject = [{ id: 'testId', isOpen: true }];
        const wrappingFn = inventoryEntitiesReducer(columns, getSelected);
        action.type = 'CLEAR_INVENTORY_STORE';
        const reducer = wrappingFn({ ...initialState, rows: testObject }, action);
        expect(reducer).toEqual(initialState);
    })
});
