import { LongTextTooltip, Shield } from '@red-hat-insights/insights-frontend-components';
import { parseCvssScore, processDate } from '@red-hat-insights/insights-frontend-components/Utilities/helpers';
import React from 'react';
import { Link } from 'react-router-dom';

export function createCveListByAccount(cveList) {
    let isLoading = cveList.isLoading;
    if (!isLoading) {
        let payload;
        if (cveList.payload.asMutable) {
            payload = cveList.payload.asMutable();
        } else {
            payload = cveList.payload;
        }

        let { data, meta, errors } = payload;

        data =
            data &&
            data.map(row => ({
                id: row.id,
                cells: [
                    <span key={row.id}>
                        <Shield
                            impact={row.attributes.impact}
                            hasTooltip={true}
                            tooltipPosition={'right'}
                            tooltipPrefix={'Impact: '}
                        />
                    </span>,
                    <span key={row.id}>
                        <Link to={'/cves/' + row.attributes.synopsis}>{row.attributes.synopsis}</Link>
                    </span>,
                    <span key={row.id}>
                        <LongTextTooltip content={row.attributes.description} maxLength={200} entryDelay={1200} />
                    </span>,
                    <span key={row.id}>{parseCvssScore(row.attributes.cvss2_score, row.attributes.cvss3_score)}</span>,
                    <span key={row.id}>{row.attributes.systems_affected}</span>,
                    <span key={row.id}>{processDate(row.attributes.public_date)}</span>
                ]
            }));
        return { data, meta, isLoading, errors };
    }

    return { data: [], meta: (cveList.payload && cveList.payload.meta) || {}, isLoading };
}

export function createCurrentVulnerabilitiesCard(impacts) {
    let dataSet = impacts.payload;
    let isLoading = impacts.isLoading;
    if (!isLoading) {
        dataSet = impacts.payload;
    }

    dataSet = { content: dataSet, isLoading };
    return dataSet;
}
