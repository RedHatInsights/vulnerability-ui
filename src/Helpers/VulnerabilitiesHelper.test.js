import { initialState } from '../Store/Reducers/VulnerabilitiesStore';
import { createCveListByAccount } from './VulnerabilitiesHelper';

const { parameters } = initialState;
describe('VulnerabilitiesHelper', () => {
    it('test function createCveListByAccount() with cveList param', () => {
        const cveList = {
            isLoading: false,
            payload: {
                meta: {
                    page: 1,
                    page_size: 25,
                    total_items: 248,
                    pages: 10,
                    sort: '-public_date',
                    filter: '',
                    show_all: 'false',
                    cvss_from: '',
                    cvss_to: '',
                    public_from: '',
                    public_to: ''
                },
                data: [
                    {
                        type: 'cve',
                        id: 'CVE-2019-6454',
                        attributes: {
                            systems_affected: 2,
                            synopsis: 'CVE-2019-6454',
                            public_date: '2019-02-18T00:00:00+00:00',
                            impact: 'Important',
                            description: '** RESERVED ** This candidate',
                            cvss2_score: '',
                            cvss3_score: '7.000',
                            business_risk_id: '3',
                            status_id: 2,
                            cve_status_id: 2
                        }
                    },
                    {
                        type: 'cve',
                        id: 'CVE-2019-6116',
                        attributes: {
                            systems_affected: 2,
                            synopsis: 'CVE-2019-6116',
                            public_date: '2019-01-23T00:00:00+00:00',
                            impact: 'Important',
                            description: 'It was found that ghostscript',
                            cvss2_score: '',
                            cvss3_score: '7.300',
                            business_risk_id: '1',
                            status_id: 1,
                            cve_status_id: 2
                        }
                    },
                    {
                        type: 'cve',
                        id: 'CVE-2019-3815',
                        attributes: {
                            systems_affected: 2,
                            synopsis: 'CVE-2019-3815',
                            public_date: '2019-01-14T00:00:00+00:00',
                            impact: 'Low',
                            description: 'A memory leak was discovered',
                            cvss2_score: '',
                            cvss3_score: '3.300',
                            business_risk_id: '2',
                            status_id: 2,
                            cve_status_id: 2
                        }
                    }
                ]
            }
        };
        expect(JSON.stringify(createCveListByAccount({ cveList, parameters }))).toMatchSnapshot();
    });

    it('VulnerabilitiesHelper - loading', () => {
        const cve_list = createCveListByAccount({
            cveList: { isLoading: true, payload: { meta: 'testObject', data: 'testData' }, parameters }
        });
        expect(cve_list).toEqual({ data: [], meta: 'testObject', isLoading: true });
    });

    it('VulnerabilitiesHelper - loading, empty meta', () => {
        const cve_list = createCveListByAccount({ cveList: { isLoading: true, payload: { data: 'testData' } }, parameters });
        expect(cve_list).toEqual({ data: [], meta: {}, isLoading: true });
    });
});
