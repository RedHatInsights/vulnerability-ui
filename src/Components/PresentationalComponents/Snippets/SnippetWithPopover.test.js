import React from 'react';
import SnippetWithPopover from './SnippetWithPopover';
import toJson from 'enzyme-to-json';
import { mountWithIntl } from '../../../Helpers/MiscHelper';

describe('SnippetWithPopover component', () => {
    it('should render with business risk', () => {
        const rowData = {
            attributes: {
                business_risk: "Not Defined",
                business_risk_id: 0,
                cve_status_id: 0,
                description: "desc",
                impact: "Moderate",
                public_date: "2019-09-13T00:00:00+00:00",
                status: "In review",
                status_id: 1,
                status_text: "justification",
                synopsis: "CVE-2019-15031"
            },
            id: "CVE-2019-15031",
            type: "cve"
        }
        const popoverBusinessRisk = mountWithIntl(<SnippetWithPopover type={0} row={rowData}/>);
        expect(toJson(popoverBusinessRisk)).toMatchSnapshot();
    });

    it('should render with default status', () => {
        const rowData = {
            attributes: {
                business_risk: "Not Defined",
                business_risk_id: 0,
                cve_status_id: 0,
                description: "desc",
                impact: "Moderate",
                public_date: "2019-09-13T00:00:00+00:00",
                status: "Not reviewed",
                status_id: 0,
                status_text: null,
                synopsis: "CVE-2019-15031"
            },
            id: "CVE-2019-15031",
            type: "cve"
        }
        const popoverStatus = mountWithIntl(<SnippetWithPopover type={1} row={rowData}/>);
        expect(toJson(popoverStatus)).toMatchSnapshot();
    });
    
    it('should render with non-default status and -- in place of missing or invalid data', () => {
        const rowData = {
            attributes: {
                business_risk: "Not Defined",
                business_risk_id: 0,
                cve_status_id: 20, // invalid option
                description: "desc",
                impact: "Moderate",
                public_date: "2019-09-13T00:00:00+00:00",
                status: null, // replaced by --
                status_id: 20, // invalid option
                status_text: null, // replaced by --
                synopsis: "CVE-2019-15031"
            },
            id: "CVE-2019-15031",
            type: "cve"
        }
        const popoverStatus = mountWithIntl(<SnippetWithPopover type={1} row={rowData}/>);
        expect(toJson(popoverStatus)).toMatchSnapshot();
    });
});
