import { find } from 'lodash';
// Initial State
const init = {
    columns: [],
    rows: [],
    entities: []
};
// Reducer

function modifyInventory(data, state) {
    const customEntities = {
        columns: [
            { key: 'display_name', title: 'Name', composed: ['display_name', 'facts.inventory.hostname'] },
            { key: 'cve_count', title: 'CVEs' },
            { key: 'updated', title: 'Last Sync', isTime: true }
        ],
        rows: [],
        entities: []
    };
    for (let apiSystem of data) {
        let inventorySystem = find(state.rows, item => item.insights_id === apiSystem.attributes.platform_id);
        if (inventorySystem) {
            inventorySystem = { ...inventorySystem, ...apiSystem.attributes };
            customEntities.rows.push(inventorySystem);
        }
    }

    customEntities.entities = customEntities.rows;

    return { ...state, ...customEntities };
}

export const inventoryEntitiesReducer = data => (state = init, action) => {
    switch (action.type) {
        case 'LOAD_ENTITIES_FULFILLED':
            return modifyInventory(data, state);

        default:
            return state;
    }
};
