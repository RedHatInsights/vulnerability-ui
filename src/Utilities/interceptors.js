import {
    authInterceptor,
    interceptor401,
    responseDataInterceptor
} from '@redhat-cloud-services/frontend-components-utilities/interceptors';
import axios from 'axios';

const instance = axios.create();

export function errorInterceptor(error) {
    if (!axios.isCancel(error)) {
        const errObject = { ...error };

        if (errObject?.response?.status === 503) {
            window.showReadOnlyBanner();
        }

        if (errObject?.response?.data?.errors) {
            const data = errObject.response.data.errors[0];
            throw data;
        }

        throw error;
    }
}

instance.interceptors.request.use(authInterceptor);
instance.interceptors.response.use(responseDataInterceptor);
instance.interceptors.response.use(null, interceptor401);
instance.interceptors.response.use(null, errorInterceptor);

export default instance;
