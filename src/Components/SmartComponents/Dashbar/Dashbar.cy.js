import React from 'react';
import { mount } from '@cypress/react';
import { BrowserRouter as Router } from 'react-router-dom';
import { Provider } from 'react-redux';
import ReducerRegistry from '../../../Utilities/ReducerRegistry';
import dashbarResponse from '../../../../cypress/fixtures/dashbar.json';
import announcementResponse from '../../../../cypress/fixtures/announcement.json';
import { IntlProvider } from '@redhat-cloud-services/frontend-components-translations';
import messages from '../../../../locales/en.json';
import Dashbar from './Dashbar';
import { changeCveListParameters } from '../../../Store/Actions/Actions';

const store = ReducerRegistry.getStore();

beforeEach(() => {
    cy.intercept('GET', '**/api/vulnerability/v1/dashbar', dashbarResponse);
    cy.intercept('GET', '**/api/vulnerability/v1/announcement', announcementResponse);

    mount(
        <IntlProvider locale="en" messages={messages}>
            <Provider store={store}>
                <Router>
                    <Dashbar />
                </Router>
            </Provider>
        </IntlProvider>
    );
});

describe('Dashbar', () => {
    it('exists and matches screenshot', () => {
        store.dispatch(changeCveListParameters({}));

        cy.get('#dashbar').matchImage();
        cy.get('#announcement').matchImage();
    });
});
