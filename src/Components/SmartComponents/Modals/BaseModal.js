import { Button, FormGroup, FormSelect, FormSelectOption, Modal, TextArea } from '@patternfly/react-core';
import {
    addNotification,
    clearNotifications
} from '@redhat-cloud-services/frontend-components-notifications/cjs/actions';
import propTypes from 'prop-types';
import React, { useState, useEffect } from 'react';
import { connect } from 'react-redux';
import { STATUS_OPTIONS } from '../../../Helpers/constants';
import messages from '../../../Messages';
import { FormattedMessage } from 'react-intl';

export function useStatusSelect(initialValue) {
    const [statusId, setStatusId] = useState(initialValue);
    const [props, setProps] = useState({});
    const StatusSelect = (
        <FormGroup label={<FormattedMessage {...messages.statusLabel} />} fieldId={'statusId'}>
            <FormSelect aria-label="Select Input" onChange={selection => setStatusId(selection)} value={statusId} {...props}>
                {STATUS_OPTIONS.map(({ value, label }) => (
                    <FormSelectOption key={value} value={value} label={label} />
                ))}
            </FormSelect>
        </FormGroup>
    );
    return { StatusSelect, statusId, setStatusId, setProps };
}

export function useJustificationInput(initialValue) {
    const [justification, setJustification] = useState(initialValue);
    const [props, setProps] = useState({});
    const JustificationInput = (
        <FormGroup label={<FormattedMessage {...messages.justificationLabel} />} fieldId={'label'}>
            <TextArea
                key="input"
                type="text"
                onChange={value => setJustification(value)}
                value={justification}
                resizeOrientation='vertical'
                aria-label={'justification note'}
                {...props}
            />
        </FormGroup>
    );
    return { JustificationInput, justification, setJustification, setProps };
}

export const BaseModal = ({ items, title, onSave, onSuccessNotification, ...props }) => {
    const [targetItems, setTargetItems] = useState(items);

    const createNotification = notification => {
        return props.addNotification(notification);
    };

    const handleClose = () => {
        setTargetItems(undefined);
    };

    const handleSave = () => {
        onSave().then(() => createNotification(onSuccessNotification));
        handleClose();
    };

    useEffect(() => {
        return () => {
            props.clearNotifications();
        };
    }, []);

    return (
        <React.Fragment>
            <Modal
                variant="small"
                title={title}
                isOpen={Boolean(targetItems)}
                onClose={handleClose}
                actions={[
                    <Button key="save" variant="primary" onClick={handleSave}>
                        {<FormattedMessage {...messages.save} />}
                    </Button>,
                    <Button key="cancel" variant="secondary" onClick={handleClose}>
                        {<FormattedMessage {...messages.cancel} />}
                    </Button>
                ]}
            >
                {props.children}
            </Modal>
        </React.Fragment>
    );
};

BaseModal.propTypes = {
    children: propTypes.any,
    onClose: propTypes.func,
    items: propTypes.array,
    updateRef: propTypes.func,
    addNotification: propTypes.func,
    title: propTypes.string,
    onSave: propTypes.func,
    onSuccessNotification: propTypes.object,
    clearNotifications: propTypes.func
};

const mapDispatchToProps = dispatch => {
    return {
        addNotification: data => dispatch(addNotification(data)),
        clearNotifications: () => dispatch(clearNotifications())
    };
};

export default connect(
    null,
    mapDispatchToProps
)(BaseModal);
