import React from 'react';
import propTypes from 'prop-types';
import { connect } from 'react-redux';
import { withRouter } from 'react-router-dom';
import { FormattedMessage } from 'react-intl';
import messages from '../../../Messages';
import { paths } from '../../../Utilities/Routes';
import { setHeader } from '../../../Store/Actions/Actions';
import { ConnectedSystemCves } from '../SystemCves/SystemCves';
import { EmptyExcludedSystem } from '../../PresentationalComponents/EmptyStates/EmptyStates';

class SystemDetail extends React.Component {
    static propTypes = {
        setHeader: propTypes.func,
        entity: propTypes.object,
        isOptOut: propTypes.bool,
        optOutSystemHandler: propTypes.func
    };

    constructor(props) {
        super(props);
    }

    render() {
        const { entity, isOptOut, optOutSystemHandler } = this.props;
        this.props.setHeader({
            breadcrumbs: [
                { title: paths.vulnerabilities.title, to: paths.vulnerabilities.to },
                { title: paths.systems.title, to: paths.systems.to },
                { title: (entity && entity.display_name) || <FormattedMessage {...messages.invalidSystem} />, isActive: true }
            ]
        });

        if (!entity) {
            return null;
        }

        if (!isOptOut) {
            return (
                <React.Fragment>
                    <ConnectedSystemCves entity={entity.id} />
                </React.Fragment>
            );
        } else {
            return (
                <React.Fragment>
                    <EmptyExcludedSystem buttonAction={() => optOutSystemHandler(false)} />
                </React.Fragment>
            );
        }
    }
}

const mapDispatchToProps = dispatch => {
    return {
        setHeader: header => dispatch(setHeader(header))
    };
};

function mapStateToProps({ entityDetails: { entity, opt_out: isOptOut } }) {
    return {
        entity,
        isOptOut
    };
}

export default withRouter(
    connect(
        mapStateToProps,
        mapDispatchToProps
    )(SystemDetail)
);
