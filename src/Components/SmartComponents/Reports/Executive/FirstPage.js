import React, { Fragment } from 'react';
import PropTypes from 'prop-types';
import { Section, Panel, PanelItem } from '@redhat-cloud-services/frontend-components-pdf-generator';
import { DateFormat as dateFormat } from '@redhat-cloud-services/frontend-components/DateFormat';
import { Text } from '@react-pdf/renderer';

import CounterItem from '../Common/CounterItem';
import messages from '../../../../Messages';

import styles from '../Common/styles';

const FirstPage = ({ data,  intl, isEdgeParityEnabled }) => {
    const { totalSystems, totalCves, totalRules, systemCountPerType  } = data;
    const { rpmdnf: conventionalCount, edge: edgeCount } = systemCountPerType || {};

    const shouldShowSystemCounts =  isEdgeParityEnabled && edgeCount > 0;
    return (
        <Fragment key="exec-first-page">
            <Text style={[styles.generated, styles.mb24]}>
                {intl.formatMessage(messages.executiveReportGenerated,
                    {
                        date: dateFormat({ date: new Date(), type: 'exact' }).props.children
                    }
                )}
            </Text>
            <Text style={styles.mb16}>
                {intl.formatMessage(messages.executiveReportHeader)}
            </Text>
            <Text style={styles.mb8}>
                {intl.formatMessage(messages.executiveReportSubHeader, {
                    systems: (
                        <Text style={styles.bold}>
                            {intl.formatMessage(messages.executiveReportHeaderSystems, { systems: totalSystems })}
                        </Text>
                    ),
                    cves: (
                        <Text style={styles.bold}>
                            {intl.formatMessage(messages.executiveReportHeaderCVEs, { cves: totalCves })}
                        </Text>
                    ),
                    rules: (
                        <Text style={styles.bold}>
                            {intl.formatMessage(messages.executiveReportHeaderRules, { rules: totalRules })}
                        </Text>
                    ),
                    hybridCounts: shouldShowSystemCounts ?
                        intl.formatMessage(
                            messages.executiveReportHeaderHybridCounts,
                            {
                                conventionalCount,
                                edgeCount
                            }
                        ) : ''
                })}
            </Text>

            <Section withColumn={false}>
                <Panel>
                    <PanelItem style={styles.counterPanel}>
                        <CounterItem
                            counter={totalSystems}
                            label={intl.formatMessage(messages.executiveReportAnalyzedSystems, { systems: totalSystems })}
                        />
                    </PanelItem>
                    <PanelItem style={styles.counterPanel}>
                        <CounterItem
                            counter={totalCves}
                            label={intl.formatMessage(messages.executiveReportAnalyzedCVEs, { cves: totalCves })}
                        />
                    </PanelItem>
                    <PanelItem style={styles.counterPanel}>
                        <CounterItem
                            counter={totalRules}
                            label={intl.formatMessage(messages.executiveReportAnalyzedRules, { rules: totalRules })}
                        />
                    </PanelItem>
                </Panel>
                {shouldShowSystemCounts ?
                    (<>
                        <Panel>
                            <PanelItem style={styles.counterPanel}>
                                <CounterItem
                                    counter={systemCountPerType?.rpmdnf || 0}
                                    aria-label="Conventional count"
                                    label="Conventional"
                                />
                            </PanelItem>
                        </Panel>
                        <Panel>
                            <PanelItem style={styles.counterPanel}>
                                <CounterItem
                                    counter={systemCountPerType?.edge || 0}
                                    aria-label="Edge count"
                                    label="Immutable"
                                />
                            </PanelItem>
                        </Panel>
                    </>)
                    : null}
            </Section>
        </Fragment>
    );
};

FirstPage.propTypes = {
    data: PropTypes.exact({
        totalSystems: PropTypes.number,
        totalCves: PropTypes.number,
        totalRules: PropTypes.number,
        systemCountPerType: PropTypes.object
    }),
    intl: PropTypes.any,
    isEdgeParityEnabled: PropTypes.bool
};
export default FirstPage;
