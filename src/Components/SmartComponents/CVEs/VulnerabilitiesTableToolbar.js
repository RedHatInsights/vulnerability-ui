/* eslint-disable camelcase */
import { ToolbarGroup } from '@patternfly/react-core';
import { TableToolbar } from '@redhat-cloud-services/frontend-components';
import propTypes from 'prop-types';
import React, { Component } from 'react';
import BaseKebab from '../../PresentationalComponents/DownloadReportKebab/BaseKebab';
import {
    kebabItemDownloadCSV,
    kebabItemDownloadJSON,
    kebabItemEditBusinessRisk
} from '../../PresentationalComponents/DownloadReportKebab/KebabItems';
import PaginationWrapper from '../../PresentationalComponents/PaginationWrapper/PaginationWrapper';
import Filters from '../Filters/Filters';
import Remediation from '../Remediation/Remediation';
import SelectAllCheckbox from '../SelectAllCheckbox/SelectAllCheckbox';
import { CVETableContext } from './VulnerabilitiesCves';

class VulnerabilitiesToolbarWithContext extends Component {
    static propTypes = {
        showAllCheckbox: propTypes.bool,
        showRemediationButton: propTypes.bool,
        entity: propTypes.object,
        context: propTypes.object
    };

    static defaultProps = {
        showAllCheckbox: false,
        showRemediationButton: false,
        totalNumber: 0,
        apply: () => undefined,
        downloadReport: () => undefined
    };

    render() {
        const { showAllCheckbox, showRemediationButton, entity, context } = this.props;
        const { cves, params, methods } = context;
        const { selectedCves } = params;
        const selectedCvesCount = selectedCves && selectedCves.length;
        const kebabOptions = [
            kebabItemEditBusinessRisk(
                methods.showBusinessRiskModal,
                selectedCves.map(item => ({ id: item, business_risk_id: '0' })),
                { isDisabled: !selectedCvesCount }
            ),
            kebabItemDownloadJSON(methods.downloadReport),
            kebabItemDownloadCSV(methods.downloadReport)
        ];
        return (
            <TableToolbar className="space-between-toolbar-items">
                <ToolbarGroup className="vulnerability-toolbar-spacing">
                    <SelectAllCheckbox
                        selectedItems={selectedCvesCount}
                        selectorHandler={methods.selectCves}
                        cves={cves}
                        fetchResource={ops => methods.fetchResource({ ...params, ...ops, show_all: !params.show_all })}
                    />
                    <Filters
                        apply={methods.apply}
                        showStatusList={Boolean(entity)}
                        showAllCheckbox={showAllCheckbox}
                        filterValues={params}
                    />
                    {showRemediationButton && <Remediation systemId={entity.id} selectedCves={selectedCves} />}
                    <BaseKebab dropdownItems={kebabOptions} />
                </ToolbarGroup>

                <ToolbarGroup>
                    <PaginationWrapper apply={methods.apply} meta={cves.meta} />
                </ToolbarGroup>
            </TableToolbar>
        );
    }
}

const VulnerabilitiesToolbar = props => (
    <CVETableContext.Consumer>
        {context => <VulnerabilitiesToolbarWithContext context={context} {...props} />}
    </CVETableContext.Consumer>
);
export default VulnerabilitiesToolbar;
