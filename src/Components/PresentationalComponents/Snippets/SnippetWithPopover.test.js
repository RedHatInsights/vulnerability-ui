import React from 'react';
import SnippetWithPopover from './SnippetWithPopover';
import { render, screen } from '@testing-library/react';
import TestWrapper from '../../../Utilities/TestWrapper';

describe('SnippetWithPopover component', () => {
    it('should render with business risk', () => {
        const rowData = {
            attributes: {
                business_risk_text: "Not Defined",
                business_risk_id: 0,
                cve_status_id: 0,
                description: "desc",
                impact: "Moderate",
                public_date: "2019-09-13T00:00:00+00:00",
                status: "In review",
                status_id: 1,
                status_text: "justification",
                synopsis: "CVE-2019-15031"
            },
            id: "CVE-2019-15031",
            type: "cve"
        };

        const { asFragment } = render(
            <TestWrapper>
                <SnippetWithPopover type={0} row={rowData}/>
            </TestWrapper>
        );

        expect(asFragment()).toMatchSnapshot();
    });

    it('should render with default status', () => {
        const rowData = {
            attributes: {
                business_risk: "Not Defined",
                business_risk_id: 0,
                cve_status_id: 0,
                description: "desc",
                impact: "Moderate",
                public_date: "2019-09-13T00:00:00+00:00",
                status: "Not reviewed",
                status_id: 0,
                status_text: null,
                synopsis: "CVE-2019-15031"
            },
            id: "CVE-2019-15031",
            type: "cve"
        };

        const { asFragment } = render(
            <TestWrapper>
                <SnippetWithPopover type={1} row={rowData}/>
            </TestWrapper>
        );

        expect(screen.getByText('Not reviewed')).toBeTruthy();
    });

    it('should render with non-default status and -- in place of missing or invalid data', () => {
        const rowData = {
            attributes: {
                business_risk: "Not Defined",
                business_risk_id: 0,
                cve_status_id: 20, // invalid option
                description: "desc",
                impact: "Moderate",
                public_date: "2019-09-13T00:00:00+00:00",
                status: null, // replaced by --
                status_id: 20, // invalid option
                status_text: null, // replaced by --
                synopsis: "CVE-2019-15031"
            },
            id: "CVE-2019-15031",
            type: "cve"
        };

        render(
            <TestWrapper>
                <SnippetWithPopover type={1} row={rowData}/>
            </TestWrapper>
        );

        expect(screen.getByText('--')).toBeTruthy();
    });
});
